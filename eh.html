<!DOCTYPE html>
<html>
<head>
<style>
textarea {
}
</style>
</head>
<body>

<h1>Drawing Transpiler</h1>

<h2>Run 'make', then paste the generated JSON file (e.g. test5.json) into src.js</h2>

<button onclick="generate ()">Generate</button>

<br>
<p id="status" > READY </p>
<br>

<p>JSON:</p>
<textarea id="drawio" rows="7" cols="120" placeholder="drawio file" style="background-color:oldlace;">
</textarea>


<p>transpiled output of phase Identity Emitter:</p>
<textarea id="phaseIdentityEmitter transpiled" rows="20" cols="120" placeholder="transpiled output from phase IdentityEmitter" style="background-color:oldlace;">
</textarea>

<p>transpiled output of phase Imports Emitter:</p>
<textarea id="phaseImportsEmitter transpiled" rows="20" cols="120" placeholder="transpiled output from phase Imports Emitter" style="background-color:oldlace;">
</textarea>

<p>transpiled output of phase Emitter:</p>
<textarea id="phaseEmitter transpiled" rows="20" cols="120" placeholder="transpiled output from phase Emitter" style="background-color:oldlace;">
</textarea>




<br>
<br>
<br>
<p>transpiled output of phase 1:</p>
<textarea id="phase1 transpiled" rows="7" cols="120" placeholder="transpiled output from phase 1" style="background-color:oldlace;">
</textarea>

<p>transpiled output of phase 2:</p>
<textarea id="phase2 transpiled" rows="7" cols="120" placeholder="transpiled output from phase 2" style="background-color:oldlace;">
</textarea>


<br>
<br>
<br>

<!-- Ohm-JS -->
<script src="https://unpkg.com/ohm-js@16/dist/ohm.min.js"></script>


<!-- Macro preprocessor -->
    <script src="fmt-js/fmt-js.js"></script>
    <script src="fmt-js/transpile.js"></script>

<!-- utilities -->
    <script src="stack.js"></script>
    <script src="panic.js"></script>
    <script src="quotes.js"></script>

<!-- mechanisms -->
    <script src="selfid2.js"></script>
    
<!-- phases -->
    <script src="das1.js"></script>
    <script src="das2.js"></script>
    <script src="dasidentityemitter.js"></script>
    <script src="dasimportsemitter.js"></script>
    <script src="daschildimporter.js"></script>
    <script src="dasemitter.js"></script>

<!-- source code -->
    <script src="src.js"></script>

<script>

  function test (infield, outfield, grammarName, grammar, fmt) {
      src = document.getElementById(infield).value;
      [success, transpiled, errormessage] = transpile (src, grammarName, grammar, fmt);
      if (success) {
          document.getElementById(outfield).value = transpiled;
          document.getElementById('status').innerHTML = "OK";
	  return [true, transpiled];
      } else {
          document.getElementById(outfield).value = transpiled;
          document.getElementById('status').innerHTML = "FAILED " + grammarName + ' ' + errormessage;
	  return [false, transpiled];
      }
  }
  
  function generate () {
      document.getElementById('drawio').innerHTML = jsonsrc;

// Information Gatherer

      let r = undefined;
      let phase1transpiled = undefined;
      [r, phase1transpiled] = test ('drawio',             'phase1 transpiled', "DaS",       dasgrammar,  dasfmt);
      console.log (`phase 1 ${r}`);

      let r2 = undefined;
      let phase2transpiled = undefined;
      [r2, phase2transpiled] = test ('phase1 transpiled', 'phase2 transpiled', "DaSphase2", dasgrammar2, dasfmt2);
      console.log (`self resolution (phase 2) ${r2}`);

      
// Code Emitter
      
      let rIdentityEmitter = undefined;
      let phaseIdentityEmitterTranspiled = undefined;
      [rIdentityEmitter, phaseIdentityEmitterTranspiled] = test ('phase2 transpiled', 'phaseIdentityEmitter transpiled', "DaSphaseIdentityEmitter", dasgrammarIdentityEmitter, dasfmtIdentityEmitter);
      console.log (`phase IdentityEmitter (phase IdentityEmitter) ${rIdentityEmitter}`);

      if (rIdentityEmitter) {
	  let rImportsEmitter = undefined;
	  let phaseImportsEmitterTranspiled = undefined;
	  [rImportsEmitter, phaseImportsEmitterTranspiled] = test ('phaseIdentityEmitter transpiled', 'phaseImportsEmitter transpiled', "DaSphaseImportsEmitter", dasgrammarImportsEmitter, dasfmtImportsEmitter);
	  console.log (`phase ImportsEmitter (phase ImportsEmitter) ${rImportsEmitter}`);

	  if (rImportsEmitter) {
	      let rEmitter = undefined;
	      let phaseEmitterTranspiled = undefined;
	      [rEmitter, phaseEmitterTranspiled] = test ('phaseImportsEmitter transpiled', 'phaseEmitter transpiled', "DaSphaseEmitter", dasgrammarEmitter, dasfmtEmitter);
	      console.log (`phase Emitter (phase Emitter) ${rEmitter}`);
	  }
      }
  }

  </script>
</body>
</html>


